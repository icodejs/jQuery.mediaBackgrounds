(function(a,b,c,d){(function(){typeof Array.prototype.contains!="function"&&(Array.prototype.contains=function(a,b){var c=this.length;while(c--)if(b){if(this[c][b]===a)return!0}else if(this[c]===a)return!0;return!1})})(),function(){a.xhrPool=[],a.xhrPool.abortAll=function(){a(this).each(function(a,b){b.abort()}),a.xhrPool.length=0},a.ajaxSetup({beforeSend:function(b){a.xhrPool.push(b)},complete:function(b){var c=a.xhrPool.indexOf(b);c>-1&&a.xhrPool.splice(c,1)}})}(),a.fn.mediaBackgrounds=function(c){var e={timer:{prev_req:0,diff_ms:0,elaps:0},errors:[],cache:{items:[]},favorites:[],win_width:1024,win_height:1024,interval_id:d,loading:!1,slideshow:!1},f={favorite:function(b){if(b&&b.data("img_dims")){var c=b.data("img_dims");e.favorites.contains(c.url,"url")||a("<img />").attr({src:c.url,width:255,height:132}).load(function(){var b=h.favorites_container.find("#favorites"),d=b.find("ul")[0]?b.find("ul"):a("<ul />").appendTo(b),f=a("<li />").hide(),i=a("<a />").attr({href:c.url,target:"_blank"}).html(a(this));f.html(i).prependTo(d).slideDown(1e3);var k=d.height()+165,l=h.favorite_controls_view_button.data("state"),m={element:h.favorite_controls_view_button,state:"open",do_toggle:l==="closed"},n={element:b,state:l,overflow:"auto",height:k>435?435:k,speed:750};g.view_favorites_show(n,function(){g.view_favorites_button(m)}),h.favorites_container.attr("style")==="display:none;"&&h.favorites_container.fadeIn(),e.favorites.push(c),j.set_status("save",e.favorites.length+" image(s) saved in your favorites!",e.favorites.length)})}},email:function(){j.set_status("email","Check your inbox! (To do)")},tweet:function(){j.set_status("tweet","tweet tweet (To do)")},save:function(){j.set_status("save","Your favorites list has been saved. (To do)")},help:function(){j.set_status("help","Use the spacebar to load new images. (To do)")},get_rnd_term:function(){var a=0,b=k.search_terms,c="";return b.length===1?f.parse_search_term(b[a]):(a=f.get_rnd_int(0,b.length-1),c=f.parse_search_term(b[a]),j.set_status("get_rnd_term","search term: "+c),c)},parse_search_term:function(a){return a.split(" ").join("+")},get_rnd_int:function(a,b){return Math.floor(Math.random()*(b-a+1))+a}},g={view_favorites:function(a,b,c){var d=b.data("state"),e=b.find("i"),f=c.find("ul").height()+30,h={element:b,state:d==="open"?"closed":"open",do_toggle:!0},i={element:c,state:h.state,overflow:d==="open"?"hidden":"auto",height:d==="open"?10:f>435?435:f,speed:750};g.view_favorites_show(i,function(){g.view_favorites_button(h)})},view_favorites_button:function(a){a.element.data({state:a.state}),a.do_toggle&&a.element.find("i").toggleClass("icon_state_close","icon_state_open")},view_favorites_show:function(b,c){var d=b.state==="open"?"easeOutQuad":"easeInQuad";b.element.stop(!0,!0),b.element.animate({height:b.height},b.speed,d,function(){a(this).css({overflow:b.overflow}),c()})}},h={bg_container:null,body:null,favorites_container:null,favorite_controls_view_button:null,img_size:null,keypress_detector:null,status:null,terms:null,window:null},i=this,j={init:function(){return h.status=a(".status"),h.favorites_container=a("#favorites_container"),h.terms=a("#terms"),h.img_size=a("#img_size"),h.window=a(b),e.win_width=h.window.width(),e.win_height=h.window.height(),h.window.on("resize",j.resize_window),i.each(function(){a("*").bind("contextmenu",function(){return!1}),h.body=a(this).height(e.win_height).on("click",function(a){a.target.id!=="controls"&&a.target.parentElement.id!=="controls"&&h.keypress_detector.focus()}),h.bg_container=a("<div />").addClass("bg_container").height(e.win_height).hide().prependTo(h.body),a(".button").on("click",function(b){b.preventDefault(),h.keypress_detector.focus();switch(a(this).attr("id").toLowerCase()){case"fav":f.favorite(h.bg_container);break;case"save":f.save(h.bg_container);break;case"email":f.email(h.bg_container);break;case"tweet":f.tweet(h.bg_container);break;case"help":f.help(h.bg_container)}}),a("#example").on("change",function(){var b=a(this).val();h.terms.val(b),h.keypress_detector.focus()}),a("#slideshow").on("change",function(){e.slideshow=a(this).attr("checked")?!0:!1,e.slideshow?(e.interval_id=setInterval(function(){a.xhrPool.length===0&&!e.loading&&j.update_ui(h.bg_container)},k.interval),j.set_status("init","Slideshow mode. A new image will load in shortly")):(clearInterval(e.interval_id),j.set_status("init","Slideshow cancelled. Press spacebar to load new images"))}),h.favorite_controls_view_button=a("#favorite_controls a").on("click",function(b){b.preventDefault(),g.view_favorites(b,a(this),a("#favorites"))}).data({state:"closed"}),h.keypress_detector=a("<input />").attr({id:"txtInput",type:"text"}).addClass("keypress_detector").focus().on("keypress",function(a){a.preventDefault();if(a.which===32&&!e.slideshow){var b=(new Date).getTime();if(e.timer.prev_req===0)e.timer.prev_req=b;else{e.timer.diff_ms=b-e.timer.prev_req,e.timer.elaps=e.timer.diff_ms/1e3;if(!(e.timer.elaps>=2))return;e.timer.prev_req=b}j.update_ui(h.bg_container)}}).appendTo(h.body),j.get_bg(h.bg_container)})},get_bg:function(b){if(e.errors.length>10)return!$slideshow&&h.body.find(".loader").fadeOut(1e3,function(){a(this).remove(),e.errors=[]}),j.set_status("get_bg","Insuffient images for the current URL. Please enter another URL or keyword(s)",e.errors);var c=0,d={},g=h.terms.val().toLowerCase(),i=g.indexOf("http://")>=0||g.indexOf("www")>=0;a(".loader").length===0&&!e.slideshow&&a("<div />").hide().addClass("loader").append(a("<img />").attr("src",k.loading_image)).appendTo(h.body).fadeIn(),j.check_cache(g,function(a){var h=e.cache.items;if(i&&a>=0&&h[a]&&h[a].images.length>0){var k=h[a].images;c=f.get_rnd_int(0,k.length-1),d={url:k[c].url},j.set_bg(d,b)}else e.errors=[],j.get_json(i,g,function(a,e){if(a)return j.set_status("get_bg",a);e&&e.length>0&&(c=f.get_rnd_int(0,e.length-1),d={url:e[c].url},j.set_bg(d,b))})})},set_bg:function(b,c){b&&b.url&&(j.preload_img(b.url,0,function(d,f){var g=a(".bg_container");if(d)return j.get_bg(c);h.bg_container=a("<div />").addClass("bg_container").height(e.win_height).css({"background-image":'url("'+b.url+'")',"background-position":"top","background-repeat":"repeat",height:e.win_height}).data("img_dims",f).prependTo(h.body),g.fadeOut(1e3,function(){a(this).remove()})}),h.keypress_detector.focus())},get_json:function(b,c,d){k.api_url.length>0&&b?url=k.api_url+c:(url="http://ajax.googleapis.com/ajax/services/search/images?v=1.0&q=",url+=c.length>0?f.parse_search_term(c):f.get_rnd_term(),url+="&imgsz=xlarge|xxlarge|huge",url+="&imgtype=photo",url+="&rsz=8",url+="&start="+f.get_rnd_int(1,50)),a.xhrPool.length>0&&a.xhrPool.abortAll(),a.ajax({url:url,dataType:"jsonp",error:function(a,b,c){return e.errors.push({func_name:"get_json",desc:b,data:c})}}).done(function(a,f){if(f==="success")try{if(a.error)return e.errors.push({func_name:"get_json",desc:a.error,data:a}),d(a.error);if(k.api_url.length>0&&b)return!e.cache.items.contains(c,"id")&&e.cache.items.push({id:c,images:a}),d(null,a);var g=a.responseData.results;return g.length?d(null,g):d("no results")}catch(h){var i={func_name:"get_json",desc:h.toString(),data:h};return e.errors.push(i),d(i)}})},preload_img:function(b,c,d){var f;e.loading=!0,h.body.find("img.preloaded").remove(),a(new Image).hide().load(function(){var f=this;j.set_status("preload_img","Loaded image with dimensions: "+f.width+" x "+f.height);var g=e.win_width,i=e.win_height;h.img_size.val().indexOf("x")>=0&&(g=h.img_size.val().split("x")[0],i=h.img_size.val().split("x")[1]);if(f.width<g||f.height<i)return error={func_name:"preload_img",desc:"image returned is too small"},e.errors.push(error),d(error);setTimeout(function(){var c={width:f.width,height:f.height,url:b};e.slideshow?(e.loading=!1,d(null,c)):h.body.find(".loader").fadeOut(1e3,function(){a(this).remove(),e.loading=!1,d(null,c)})},c)}).addClass("preloaded").attr("src",b).prependTo("body").error(function(a){return error={func_name:"preload_img",desc:"404 (Not Found)",data:a},e.errors.push(error),j.set_status("preload_img",error.desc),d(error)})},resize_window:function(){var b=a(this);e.win_width=b.width(),e.win_height=b.height(),h.bg_container.css({height:e.win_height}),h.body.css({height:e.win_height})},update_ui:function(a){a&&j.get_bg(a)},check_cache:function(a,b){var c,d=e.cache.items,f=d.length;if(d.length>0)for(c=0;c<f;c+=1)if(a.toLowerCase()===d[c].id.toLowerCase())return b(c);return b(-1)},set_status:function(b,c,d){h.status.find("div").fadeOut().end().html("").append(a("<div>"+c+(b==="save"?' <a href="#" id="view" class="button">view</a>':"")+" ..."+"</div>").fadeIn(1e3)).fadeIn()},destroy:function(){return i.each(function(){})}},k=a.extend({api:"google_image_search",api_url:"",loading_image:"img/loader.gif",search_terms:["graffiti"],media_type:"img",interval:15e3,user_id:-1,rest_url:""},c);j.init()}})(jQuery,window,document)